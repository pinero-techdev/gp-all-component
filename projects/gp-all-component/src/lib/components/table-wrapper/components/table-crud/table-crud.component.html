<p-toast></p-toast>
<div class="p-grid gp-table-wrapper" *ngIf="!working && columns.length > 0">
  <div class="p-col-12 table-section" [class.p-xl-6]="displayEdicion">
    <div class="card panel-content">
      <p-table
        #tc
        [columns]="columnsToRender"
        [value]="data"
        [rows]="10"
        [paginator]="true"
        [pageLinks]="4"
        [rowsPerPageOptions]="[10, 20, 50]"
        selectionMode="single"
        [(selection)]="selectedRow"
        (onRowSelect)="onRowSelect()"
        (onRowUnselect)="closeDialog()"
        csvSeparator=";"
        exportFilename="table_crud_export"
        sortMode="multiple"
      >
        <ng-template pTemplate="caption">
          <div class="p-grid">
            <div class="p-col-8">Mantenimiento de tabla {{ tableLabel }}</div>
            <div class="p-col-4">
              <gp-button
                *ngIf="canAdd"
                [type]="'icon'"
                icon="pi pi-plus"
                label="Añadir"
                (click)="onDialogAdd()"
                [disabled]="formControl.lockFields"
              >
              </gp-button>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
              {{ col.fieldMetadata.displayInfo.fieldLabel }}
              <p-sortIcon
                [field]="col.field"
                class="sort-icon"
                ariaLabel="Activate to sort"
                ariaLabelDesc="Activate to sort in descending order"
                ariaLabelAsc="Activate to sort in ascending order"
              ></p-sortIcon>
            </th>
          </tr>
          <tr>
            <th *ngFor="let col of columns" class="column-filter">
              <input
                pInputText
                type="text"
                class="full-width"
                (input)="tc.filter($event.target.value, col.field, 'startsWith')"
              />
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td *ngFor="let col of columns">
              {{ rowData[col.fieldMetadata.fieldName] }}
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer" let-columns>
          <div class="action-button-wrapper">
            <gp-button
              [type]="'icon'"
              icon="pi pi-download"
              (click)="tc.exportCSV()"
              label="Exportar a CSV"
            ></gp-button>
          </div>
        </ng-template>
      </p-table>
    </div>
  </div>

  <div class="p-col-12 p-xl-6 form-section">
    <div *ngIf="displayEdicion" class="card panel-content">
      <div class="p-grid">
        <h3 class="p-col-12 big-topic">
          <span *ngIf="formControl.edicionEdit">Edición</span>
          <span *ngIf="!formControl.edicionEdit">Nuevo</span> -
          {{ tableLabel }}
        </h3>
      </div>
      <gp-dynamic-form
        [metadata]="metadata"
        [data]="formControl?.originalRow"
        [config]="config"
        (onCancel)="closeDialog($event)"
        (onSubmit)="onDialogSave($event)"
        (onDelete)="onDialogDelete($event)"
      ></gp-dynamic-form>
    </div>
  </div>
</div>

<div *ngIf="working">
  <gp-loading-indicator></gp-loading-indicator>
</div>
